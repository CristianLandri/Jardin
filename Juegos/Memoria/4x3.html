<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego de Memoria 4x3</title>
<link rel="stylesheet" href="/Jardin/Static/bootstrap-5.3.7-dist/bootstrap-5.3.7-dist/css/bootstrap.min.css">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Chewy&display=swap');
  body {
    background: linear-gradient(135deg, #e4bfe9, #8c52ff);
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    margin: 0;
    font-family: 'Chewy', cursive;
    color: white;
  }

  h1 {
    text-shadow: 3px 3px 0 #4f3ba4;
    font-size: 2.8rem;
    margin-top: 1rem;
  }

  #timerBarContainer {
    width: 80%;
    height: 25px;
    background-color: #fff;
    border-radius: 12px;
    margin: 1rem auto;
    overflow: hidden;
  }

  #timerBar {
    height: 100%;
    width: 100%;
    background-color: #28a745;
    transition: width 0.2s linear, background-color 0.2s;
  }

   .memory-card {
    aspect-ratio: 1/1;
    background-color: #aa69ff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1.5rem, 5vw, 3rem);
    cursor: pointer;
    border-radius: 16px;
    user-select: none;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.5s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.25);
  }

  .memory-card.flipped {
    background-color: #fff;
    transform: rotateY(180deg);
    cursor: default;
  }

  .memory-card .front, .memory-card .back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .memory-card .front {
    transform: rotateY(180deg);
    font-size: clamp(1.5rem, 6vw, 3rem);
  }

  .memory-card .back {
    background-color: #4f3ba4;
    border-radius: 16px;
  }

  .disabled { pointer-events: none; }

  .modal-content {
    border-radius: 20px;
    text-align: center;
  }

  .btn {
    font-family: 'Chewy', cursive;
    border-radius: 10px;
  }
</style>
</head>
<body>
<div class="container py-4">
  <h1 class="text-center mb-3">üçé Juego de Memoria 4x3 üçè</h1>
  <div id="timerBarContainer">
    <div id="timerBar"></div>
  </div>
  <div id="gameBoard" class="row g-3 justify-content-center"></div>
</div>

 
<div class="modal fade" id="endModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered text-center">
    <div class="modal-content p-4">
      <h2 id="modalTitle" class="mb-3"></h2>
      <div id="modalEmoji" class="mb-3" style="font-size:3rem;"></div>
      <div id="modalImageContainer" class="mb-3"></div>
      <div id="modalButtons" class="d-flex justify-content-center gap-3 flex-wrap"></div>
    </div>
  </div>
</div>

 
<audio id="flipSound" src="flip.mp3" preload="auto"></audio>
<audio id="matchSound" src="match.mp3" preload="auto"></audio>
<audio id="failSound" src="fail.mp3" preload="auto"></audio>
<audio id="winSound" src="win.mp3" preload="auto"></audio>
<audio id="loseSound" src="lose.mp3" preload="auto"></audio>

<script src="/Jardin/Static/bootstrap-5.3.7-dist/bootstrap-5.3.7-dist/js/bootstrap.bundle.min.js"></script>
<script>
 
const symbols = ["üçé","üçå","üçá","üçí","üçâ","üçç"];
let cards = [...symbols, ...symbols];
cards.sort(() => 0.5 - Math.random());

const gameBoard = document.getElementById("gameBoard");

 
for (let i=0;i<3;i++){
  const row = document.createElement("div");
  row.className="row g-3";
  for (let j=0;j<4;j++){
    const symbol = cards[i*4 + j];
    const col = document.createElement("div");
    col.className="col-3 col-sm-3 col-md-3";
    col.innerHTML=`
      <div class="memory-card">
        <div class="front">${symbol}</div>
        <div class="back"></div>
      </div>`;
    row.appendChild(col);
  }
  gameBoard.appendChild(row);
}

 
let firstCard = null;
let lockBoard = true;
let timer = 40;
const maxTime = 40;
const timerBar = document.getElementById("timerBar");
let timerInterval = null;
let matches = 0;
let wrongMatches = 0; // contador de fallos
const totalPairs = symbols.length;

 
const endModal = new bootstrap.Modal(document.getElementById('endModal'));
const modalTitle = document.getElementById('modalTitle');
const modalEmoji = document.getElementById('modalEmoji');
const modalButtons = document.getElementById('modalButtons');
const modalImageContainer = document.getElementById('modalImageContainer');

 
function updateTimerBar() {
  const percentage = (timer/maxTime)*100;
  timerBar.style.width = percentage + "%";
  timerBar.style.backgroundColor = percentage<30?"#dc3545":"#28a745";
}

function playSound(id){
  const sound = document.getElementById(id);
  sound.currentTime = 0;
  sound.play();
}

function checkMatch(card1, card2){
  if(card1.textContent === card2.textContent){
    playSound("matchSound");
    card1.parentElement.classList.add("disabled");
    card2.parentElement.classList.add("disabled");
    timer = Math.min(timer + 3, maxTime);
    updateTimerBar();
    matches++;
    if(matches===totalPairs) gameOver(true);
  } else {
    
    wrongMatches++;
    playSound("failSound");
    setTimeout(()=>{
      card1.parentElement.classList.remove("flipped");
      card2.parentElement.classList.remove("flipped");
    },800);
  }
}

function startTimer(){
  timerInterval = setInterval(()=>{
    timer -= 0.1;
    if(timer<=0){
      timer=0;
      clearInterval(timerInterval);
      gameOver(false);
    }
    updateTimerBar();
  },100);
}

function stopTimer(){
  clearInterval(timerInterval);
}

function gameOver(won){
  lockBoard=true;
  stopTimer(); // ‚èπÔ∏è Detener el tiempo

  modalButtons.innerHTML="";
  modalImageContainer.innerHTML="";

  modalTitle.textContent = won ? "¬°Ganaste!!!" : "¬°Perdiste!!!";
  modalTitle.style.color = won ? "#28a745" : "#dc3545";
  modalEmoji.textContent = won ? "" : "";

  
  if(won){
    playSound("winSound");
    const winImage = document.createElement("img");
    winImage.src = "ganaste-removebg-preview.png"; // üñºÔ∏è Imagen de victoria
    winImage.alt = "Ganaste";
    winImage.style.width = "200px";
    winImage.style.marginBottom = "15px";
    modalImageContainer.appendChild(winImage);
  } else {
    playSound("loseSound");
    const loseImage = document.createElement("img");
    loseImage.src = "perdiste-Photoroom.png"; // üñºÔ∏è Imagen de derrota
    loseImage.alt = "Perdiste";
    loseImage.style.width = "200px";
    loseImage.style.marginBottom = "15px";
    modalImageContainer.appendChild(loseImage);
  }

  
  // Crear botones program√°ticamente para evitar que reescrituras de innerHTML
  modalButtons.innerHTML = '';
  function makeBtn(text, handler, cls) {
    const b = document.createElement('button');
    b.type = 'button';
    b.className = (cls || 'btn');
    b.textContent = text;
    b.addEventListener('click', handler);
    return b;
  }

  if (won) {
    modalButtons.appendChild(makeBtn('Siguiente Juego', () => { window.location.href = '/Jardin/Juegos/Memoria/index.html'; }, 'btn btn-success'));
  } else {
    modalButtons.appendChild(makeBtn('Reintentar', () => location.reload(), 'btn btn-primary'));
  }

  modalButtons.appendChild(makeBtn('Volver al Inicio', () => { window.location.href = '/Jardin/Juegos/Memoria/index.html'; }, 'btn btn-secondary'));

  
  if (won) {
  const puntosGanados = Math.max(1, 6 - wrongMatches);
    sendPoints(puntosGanados);
    const info = document.createElement('div');
    info.className = 'w-100 mt-2';
    info.innerHTML = `<small>Has ganado <strong>${puntosGanados}</strong> puntos (fallos: ${wrongMatches})</small>`;
    document.querySelector('#endModal .modal-content').appendChild(info);
  }

  endModal.show();
  
  if (won) {
    
    setTimeout(() => { window.location.href = 'index.html'; }, 600000);
  }
}

 
async function sendPoints(points) {
  const nombre = localStorage.getItem('usuario');
  if (!nombre) return console.warn('No hay usuario en localStorage, puntos no enviados');
  try {
    const resp = await fetch('/Jardin/Essencial/Excepcional/sumar_puntos.php', {
      method: 'POST',
      body: new URLSearchParams({ nombre, puntos: points })
    });
    const data = await resp.json();
    console.log('Respuesta sumar_puntos:', data);
    if (data && typeof data.puntos !== 'undefined') {
      localStorage.setItem('puntos', data.puntos);
    }
  } catch (err) {
    console.error('Error enviando puntos:', err);
  }
}

 
const allCards = document.querySelectorAll(".memory-card");
allCards.forEach((card,index)=>{
  setTimeout(()=>card.classList.add("flipped"),index*150);
});
setTimeout(()=>{
  allCards.forEach(card=>card.classList.remove("flipped"));
  lockBoard=false;
  startTimer();
},allCards.length*150+1000);

 
allCards.forEach(card=>{
  card.addEventListener("click",()=>{
    if(lockBoard || card.classList.contains("flipped")) return;
    card.classList.add("flipped");
    playSound("flipSound");
    const front = card.querySelector(".front");
    if(!firstCard) firstCard=front;
    else { 
      checkMatch(firstCard,front);
      firstCard=null;
    }
  });
});
</script>
</body>
</html>


